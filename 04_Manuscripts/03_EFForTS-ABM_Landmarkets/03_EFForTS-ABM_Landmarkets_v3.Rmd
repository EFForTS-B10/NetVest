---
title: "How prices drive a landscape"
author:
  - Jan Salecker:
      email: jsaleck@gwdg.de
      institute: [affil1]
      correspondence: true
  - Sebastian Renner:
      email: Sebastian.Renner@giga-hamburg.de
      institute: [affil2]
      correspondence: false
  - Julia Henzler:
      email: julia.henzler@uni-goettingen.de
      institute: [affil1]
      correspondence: false
  - Kerstin Wiegand:
      email: Kerstin.Wiegand@mail.uni-goettingen.de
      institute: [affil1]
      correspondence: false
institute:
  - affil1: University of Goettingen, Department of Ecosystem Modelling
  - affil2: GIGA, Hamburg
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../../03_Analyses/",
  dpi = 300
)
```

## Introduction

Land-use changes have dramatically altered tropical landscapes in past decades [@Powell2015]. bla bla bla.

Economic models are great learning tools to understand the underlying dynamics and processes [cite]. Recently, economic models are coupled to ecological models in order to gain insights into trade-offs and synergies between the ecological and socio-economic sphere [@Schulze2017; @An2012]. EFForTS-ABM is such a coupled socio-economic ecological simulation model, focusing on smallholder agriculture in Jambi province, Indonesia [@Dislich2018]. The model simulates rational economic decision-making of smallholder farmers and calculates consequences on the ecological sphere. In earlier publications and detailed sensitivity analyses we found that output crop prices are major drivers of economic and ecological patterns at multiple spatial and temporal scales [@Dislich2018]. For example, low prices led to a high amount of bankrupcy of smallholders, expecially when heterogenous farming efficiency was included [@Dislich2018]. This led to high amounts of abandoned land. In reality however, land is mostly offered on the land market when smallholders drop out of business. Thus, we implemented a new model version that features a landmarket module which allows the transfer of land between households. Here we present a detailed analysis of the new version of EFForTS-ABM including a detailed analyses of the new landmarket activities.

Because prices were the main driver for smallholder bankrupcy [@Dislich2018] we assume that prices are also the main driver of landmarket activities within our simulations. In order to gain a detailed understanding of model interactions, we need to conduct and analyze price scenarios. In the real world, crop output prices depend on global markets and are very dynamic and nearly unpredictable [cite]. In general, we see two approaches on tackling this issue: (i) If the goal is to run model simulations that are close to reality, one could use historical output price data (as we did before, see xy [cite]) or simulated price data. (ii) If the goal is however to learn about the model processes and interactions, dynamic output prices create a lot of noise which hinders accurate interpretations of underlying mechanisms. In such cases, it is essential to investigate simple price scenarios, such as constant prices including price shock events at one point in time.

In this paper, we want to investigate our simulation model EFForTS-ABM, using the second kind of approach. Here, we are interested how different facets of spatial and non-spatial output react to changes in the output crop prices. The main question is therefore, "How do prices affect household properties, landscape properties, and overall economic and ecological indicators in EFForTS-ABM?".

## Methods

Our analysis was conducted with EFForTS-ABM version xy [cite]. Simulations were executed on the GWDG-HPC of the university of GÃ¶ttingen, through the R package nlrx [@Salecker2019a]. The initial landscape was created through our landscape generator EFForTS-LGraf [@Salecker2019]. A detailed description of the EFForTS-ABM model was published in [@Dislich2018].

#### Short description of EFForTS-ABM

- Jan

#### Description of the new landmarket module

- Sebastian Renner

#### Description of the biodiversity module

- Julia Henzler

#### Scenarios

Smallholders in our model landscapes were allowed to choose between two different crop types: oil palm and rubber monoculture. Simulations are performed over 50 simulation years. In our simulation experiment, we varied the output prices of these two crops in a full-factorial simulation design. The minimum and maximum price levels for both crops were derived from historical price data [cite]. We varied both prices between minimum and maximum by adding 18 intermediate steps with equal intervals, resulting in a matrix of 20 x 20 simulations. As additional scenarios, we were interested how certain price events affect measured outputs. We ran 4 such events that were triggered after 20 years of simulation under the default parameterization. The events were a price reduction of -50% for rubber or palm oil and a price boom of +50% for rubber or palm oil. Thus, the 20 x 20 parameter matrix was executed 5 times in total (default, shock rubber, shock oilpalm, boom rubber, boom oilpalm) with 3 replicates, resulting in 6000 simulations.

We ran the full-factorial simulation design and exported output from the last 25 years. Several spatial and non-spatial outputs were collected during and after simulations (see Table xy). We binned outputs into four variable groups with equal intervals for easier visual interpretation. Output measurements can be classified by scale (household, villages, cell, patch, landscape) and by category (economic, ecological).

*Further parameterisation: The landmarkets were set to active, and heterogeneity is present with learning activated.*


## Results and discussion

#### Part I: Landscape patterns

```{r rubber, out.width = "100%", fig.cap = "Variation of mean rubber area under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_sens_rubber_area.png")
```

As expected, the mean area of rubber agriculture correlated linearly with rubber output prices (Fig. \@ref(fig:rubber), see also Fig. \@ref(fig:oilpalm) in Appendix I for oilpalm area). While this seems to be a trivial result, it verifies the functionality of the rationale economic decision-making algorithm of EFForTS-ABM: When prices are high smallholder agents switch to the more profitable crop. Still, due to the crop-specific inefficiencies and heterogeneous household sizes, profitability is not equally distributed among agents, which leads to the observed variability of crop choices for intermediate prices.
When prices boomed for one specific crop, the area of that crop increased and vice versa (Fig. \@ref(fig:rubber), see also Fig. \@ref(fig:oilpalm) in Appendix I for oilpalm area). 
The land-use decisions also affect the spatial arrangement of patches in the landscape. The mean patch area within the landscape was highest when only one of the two crops had higher prices (Fig. \@ref(fig:areamn) in Appendix I). The edge density showed a reverse pattern with highest heterogeneity for intermediate scenarios were both crops were equally present in the landscape (see panel o in Fig. \@ref(fig:rawvar)). Thus, patch area is increasing and edge density is decreasing for landscapes which are dominated by one crop.

#### Part II: Landmarkets

```{r hhn, out.width = "100%", fig.cap = "Variation of number of households under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_sens_household_nr.png")
```

```{r hhsize, out.width = "100%", fig.cap = "Variation of household size under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_sens_household_size.png")
```

In EFForTS-ABM, households may become bankrupt when they take up debts and are not able to pay them back within a specified time period. In previous model versions, the owned land of bankrupt households was abandoned. With the new landmarket module, land is offered on a landmarket and other neighboring households, or new immigrating households have a chance to buy the land (Details, see Methods xy).
Depending on whether immigrants or already existing households buy land, consolidation may be present. Indeed, when prices for both crops are low, we observe fewer households with larger household area (Fig. \@ref(fig:hhn) and Fig. \@ref(fig:hhsize)), meaning that only the most efficient households are able to stay in business and buy land from other smallholders. The four price scenarios had a strong effect on these measures. Booming prices led to increasing household numbers, especially for very low initial price settings. We also observed a stronger effect when one crop had already high prices from the start and the other price was increased within the scenario (e.g. high initial rubber prices and oilpalm boom). Price shocks mainly led to a reversed pattern, but interestingly we observed an increase in household numbers for very low prices under rubber price shocks. 

We observed a peak of immigrant households for the second lowest price settings (Fig. \@ref(fig:immin) in Appendix I). With these prices, immigrant households were able to utilize landmarket investments efficiently, due to improved inefficiencies and wealth, whereas buying land was not efficient for initial model households. For the lowest price settings, buying land was not an attractive option for both, initial households and immigrant households. The sensitivity of the number of immigrant households towards price events showed a mostly random pattern and no direct relation to the initial price settings.


LM_RATIO  (seller/buyer welath in Appendix)
ABANDONED
CAPITALSTOCK

*UPDATE

In such cases we could also observe some abandoned land of up to 73% when both crop prices were at their minimum (see panel f in Fig. \@ref(fig:rawvar)). That means that neither initial, nor immigrant households were able to sufficiently manage the land.

As expected, smallholder households offering land on the landmarket had relatively low wealth when compared to the average buyers wealth (see panel g,h,i in Fig. \@ref(fig:rawvar))). For low prices, sellers had only up to ~18% of the wealth of the final buyer of the offered land. The ratio between sellers and buyers wealth increased up to 83%, when both crops had intermediate to high output prices. Here, bankrupcy was not the main cause for landmarket transactions but insteaded, most landmarket offers were household-age related.



#### Part III: Trade-offs and synergies

```{r consumption, out.width = "100%", fig.cap = "Variation of household consumption under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_sens_consumption_k.png")
```

```{r carbon, out.width = "100%", fig.cap = "Variation of carbon accumulation under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_sens_carbon_k.png")
```

```{r biodiversity, out.width = "100%", fig.cap = "Variation of biodiversity under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_sens_biodiversity.png")
```

A huge advantage of coupled economic-ecological models is the possibility to assess synergies and trade-offs between the economic and ecological sphere. Our main measure of economic benefit is the mean consumption of households. The consumption scales linearly with the maximum of both crop prices, thus increasing prices might not necessarily lead to higher consumption (Fig. \@ref(fig:consumption). A price boom in oilpalm or rubber does only have significant positive effects on household consumption, when the other crop price is comparatively low. However, price boom events can even lead to reduced consumption, when prices of the other crop were already high initially.

We observe two extremes of carbon accumulation for very low prices and high prices (Fig. \@ref(fig:carbon_k)). These patterns are clearly related to the decision-making of the households. For low prices, land-use change is not worth the investment costs, thus carbon is continuously accumulated due to less land-use change decisions. For very high prices, returns from land are stable and sufficient, thus life cycles of plantations are extended which also leads to higher carbon accumulation. Overall, we observe slightly higher carbon accumulation for high rubber prices, than for high palm oil prices. 

The biodiversity shows a very clear pattern with improved biodiversity for high rubber prices (Fig. \@ref(fig:biodiversity)). However, the biodiversity is calculated with preliminary parameter values, so we need to take caution interpreting these values. But it seems that rubber-dominated farming is better for landscape-wise biodiversity.

In summary, we could show that consumption (which relates to economic welfare within our virtual smallholder community), carbon accumulation and biodiversity follow quite different trajectories when output prices of crops change. Heterogeneous responses between different output variables automatically lead to trade-off and synergy cases when comparing these variables. All three variables relate to ecosystem functioning and services and are of utmost importance when it comes to policy design and conservation approaches towards fulfilling sustainable development goals in the future [cite]. Thus, we were highly interested if there are certain price patterns that could lead to high synergies across the three outputs.

In order to calculate synergies, we classified each output into four value classes (representing quartiles). Then we calculated the mean class value of several outputs for each output price. Thus, a score of four indicates maximum synergy (both outputs were in the highest quartile).

```{r tradeoff, out.width = "100%", fig.cap = "Variation of trade-off scores under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_synergy_sens_consumption_carbon_biodiversity.png")
```

Indeed, we observed cases were multiple outputs were located in the highest value class (see Fig. \@ref(fig:tradeoff)).
We could observe a large overlap of high consumption and biodiversity for high rubber prices. Even, when palm oil prices where comparably high, this synergy persisted. For consumption and carbon we observed a similar trend but synergy was best when prices for both crops were at their maximum. Finally, we found scenarios that lead to maximum class scores for all three outputs. Such price settings represent best case scenarios within our model landscapes. Such scenarios could be reached with very high rubber prices or intermediate prices for both crops. While a complete dominance of rubber could potentially lead to high synergy of economic and ecological outputs, this is not the case for oil palm. Here a complete dominance leads to stronger trade-offs among our measured outputs.  In sumamry, landscapes that are oil palm dominated show stronger trade-offs between the economic and ecological sphere than landscapes that are rubber dominated!

We also investigated the sensitivity of our synergy scores that explicitly incorporate the economic and ecological sphere.
A boom in palm oil prices led to an improvement of synergies only for scenarios where the landscape was already dominated by oil palm (Fig. \@ref(fig:tradeoff)). When oil palm prices dropped drastically, we see an improvement for most initial price settings, except cases where rubber prices where very low and oil palm prices where high. These are again, landscapes that are completely dominated by oil palm agriculture. A drastic prices drop thus heavily reduces consumption values in the landscape as households are not able to compensate lower palm oil prices with rubber agriculture.

A boom in rubber prices led to decreasing synergy scores for all landscapes that were oilpalm dominated. Only landscapes that had an equal share of rubber and oilpalm or landscapes completely rubber dominated could profit from the price boom. The rubber price shock heavily decreased the synergy score of many rubber dominated landscapes. However, it also increased the synergy score of all landscapes that were previously oilpalm dominated.

## Outlook

The most important thing is to improve the biodiversity model. Julia is working on this!
Besides that some questions need to be discussed:

* What do you think of the experimental design (full-factorial with constant prices)?
    * I find it very interesting and easy to understand - Is this interesting also for publication (I think yes)?
    * Do you have suggestions for improvements? (other/additional metrics)
    * Should we add even more complexity?
* How do we want to treat the abandoned land in the future?
* What is going wrong with the capitalstock?
* Why do we see the highest AND lowest carbon class for low prices?



<!-- The following line inserts a page break  -->
\newpage

# References 
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>


\newpage

### Appendix

#### Appendix I: Additional price event sensitivity plots

```{r oilpalm, out.width = "100%", fig.cap = "Variation of mean oilpalm area under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_sens_oilpalm_area.png")
```

```{r areamn, out.width = "100%", fig.cap = "Variation of mean patch area under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_sens_area_mn.png")
```

```{r ed, out.width = "100%", fig.cap = "Variation of edge density under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_sens_ed.png")
```

```{r immin, out.width = "100%", fig.cap = "Variation of number of immigrant households under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_sens_immigrant_nr.png")
```

```{r abandoned, out.width = "100%", fig.cap = "Variation of abandoned land under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_sens_abandoned.png")
```

```{r lmratio, out.width = "100%", fig.cap = "Variation of buyer-seller wealth ratio under different output price settings. Tile colors represent the default price scenario where bright colors indicate high values and dark colors represent low values. The arrows represent sensitivity towards price boom and shock scenarios with larger arrows indicating stronger sensitivity. Arrow color indicates effect direction with white arrows indicating increase and black arrows indicating decrease."}
knitr::include_graphics("../../03_Analyses/06_landmarket_v2/tileplot_sens_lm_ratio.png")
```


\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
