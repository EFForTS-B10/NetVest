---
title: "How prices drive a landscape"
author:
  - Jan Salecker:
      email: jsaleck@gwdg.de
      institute: [affil1]
      correspondence: true
institute:
  - affil1: University of Goettingen, Department of Ecosystem Modelling
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../../03_Analyses/",
  dpi = 300
)
```

## Introduction


Economic models are a great learning tools to understand underlying dynamics and processes [cite]. Recently, economic models are coupled to ecological models in order to gain insights into trade-offs and synergies between the ecological and socio-economic sphere [cite]. EFForTS-ABM is such a coupled socio-economic ecological simulation model, focusing on smallholder agriculture in Jambi province, Indonesia [cite]. The model simulates rational economic decision-making of smallholder farmers and calculates consequences on the ecological sphere. In earlier publications and detailed sensitivity analyses we found that output crop prices are major drivers of economic and ecological patterns at multiple spatial and temporal scales [cite]. For example, low prices led to a high amount of bankrupcy of smallholders, expecially when heterogenous farming efficiency was included [cite]. This led to high amounts of abandoned land. In reality however, land is mostly offered on the land market when smallholders drop out of business. Thus, we implemented a new model version that features a landmarket module which allows the transfer of land between households. Here we present a detailed analysis of the new version of EFForTS-ABM including a detailed analyses of the new landmarket activities.

Because prices were the main driver for smallholder bankrupcy [cite] we assume that prices are also the main driver of landmarket activities within our simulations. In order to gain a detailed understanding of model interactions, we need to conduct and analyze price scenarios. In the real world, crop output prices depend on global markets and are very dynamic and nearly unpredictable [cite]. In general, we see two approaches on tackling this issue: (i) If the goal is to run model simulations that are close to reality, one could use historical output price data (as we did before, see xy [cite]) or simulated price data. (ii) If the goal is however to learn about the model processes and interactions, dynamic output prices create a lot of noise which hinders accurate interpretations of underlying mechanisms. In such cases, it is essential to investigate simple price scenarios, such as constant prices including price shock events at one point in time.

In this paper, we want to investigate our simulation model EFForTS-ABM, using the second kind of approach. Here, we are interested how different facets of spatial and non-spatial output react to changes in the output crop prices. The main question is therefore, "How do prices affect household properties, landscape properties, and overall economic and ecological indicators in EFForTS-ABM?".

## Methods

Our analysis was conducted with EFForTS-ABM version xy [cite]. Simulations were executed on the GWDG-HPC of the university of GÃ¶ttingen, through the R package nlrx [cite]. The initial landscape was created through our landscape generator EFForTS-LGraf [cite]. A detailed description of the EFForTS-ABM model was published in [cite].

#### Short description of EFForTS-ABM

@Jan

#### Description of the new landmarket module

@SebastianRenner

#### Scenarios

Smallholders in our model landscapes were allowed to choose between two different crop types: oil palm and rubber monoculture. Simulations are performed over 50 simulation years. In our simulation experiment, we varied the output prices of these two crops in a full-factorial simulation design. The minimum and maximum price levels for both crops were derived from historical price data [cite]. We varied both prices between minimum and maximum by adding 18 intermediate steps with equal intervals, resulting in a matrix of 20 x 20 simulations. As additional scenarios, we were interested how certain price events affect measured outputs. We ran 4 such events that were triggered after 20 years of simulation under the default parameterization. The events were a price reduction of -50% for rubber or palm oil and a price boom of +50% for rubber or palm oil. Thus, the 20 x 20 parameter matrix was executed 5 times in total (default, shock rubber, shock oilpalm, boom rubber, boom oilpalm) with 3 replicates, resulting in 6000 simulations.

Several spatial and non-spatial outputs were collected during and after simulations (see Table xy).
Output measurments can be classified by scale (household, villages, cell, patch, landscape) and by category (economic, ecological). 

*Further parameterisation: The landmarkets were set to active, and heterogeneity is present with learning activated.*


## Results

#### Part I: 




#### Part II: Trade-offs and synergies


#### Part III: Sensitivity towards price changes





## Comments on first analysis

After running and analysing the first experiment, I noticed some strange things within the land distribution.
Land can still be abandoned even when the landmarket module is active. This problem arises, when no buyer in the potential buyer pool wants to buy the land, which can happen due to bad prices for both crops. Then, we still have the problem of abandoned land in the model.
Additionally, in the former landmarket module, land was offered once when any household went bankrupt or was selling land due to household age. Then, if no buyer was determined, land was just abandoned. 
I updated this routine in the new version: Now, landmarkets can persist over multiple ticks. Active landmarkets will be offered again in the next tick if no buyer was determined. That way, land may be bought once prices are better or households were able to collect some wealth for investment. Even with this version, abandoned land might still be present and we need to decide what to do with it in the future (see Outlook)!

## Results of full-factorial price experiment with current model version

I first extracted the 25 last years of each simulation and checked the correlation between different output measurements:

```{r corplot, fig.align = 'center', out.width = "100%", fig.cap = "Correlations"}
knitr::include_graphics("../../03_Analyses/05_Refforts_constantPrices/prices_ff_correlations.png")
```

We can see quite heavy correlations among many different outputs (Fig. \@ref(fig:corplot)).
The spatial variables edge density (ed) and patch area (area_mn) are strongly correlated.
Biodiversity is correlated positively with rubber_area and carbon, but negatively correlated with oilpalm_area and capitalstock.
Household size is correlated with household number, indicating that our landmarket module seems to be working.

Now lets take a look at some output measurements. Again, I only took output from the last 25 years and classified each output into 8 classes for improved visualization (Fig. \@ref(fig:metrics)).

```{r metrics, fig.align = 'center', out.width = "100%", fig.cap = "Metrics"}
knitr::include_graphics("../../03_Analyses/05_Refforts_constantPrices/prices_ff_tradeoff_p1.png")
```

The first two panels (rubber area, oilpalm area) are quite clear: Rubber area is high when rubber prices are high. Oilpalm shows a reversed pattern. However, we can now see the price levels at which certain percentages are reached. We can also see that the area of crops scales linearly with prices. 

The next four panels (household_nr, immigrant_nr, household_size, abandoned) give us some information on the landmarket. We can see, that with high prices, we more or less stay at the initial number of households (192). When prices are lower, we have less households in the model, however we only see larger houshold size effects for very low prices. This seems to be a bit contradictory at first, but what happens is that for intermediate prices we lose small households only. Households with only one or two fields are more likely to leave the model, thus we see a decrease in household number, but no significant increas in household size. We can also see that the landmarket seems to be quite active for very low prices where we see strong decreases in household number and strong increases in immigrant number and household area. We can also see that the abandoned land seems to be a problem only when prices are very low.

The capitalstock panel shows high capitalstock for low prices? I need to investigate this further.

The consumption panel shows that consumption is high when at least one crop shows high prices. For carbon, we see very high levels for small prices, probably because households are not able to replant old plantations. The biodiversity is calculated with preliminary parameter values, so we need to take caution interpreting these values. But it seems that rubber-dominated farming is better for landscape-wise biodiversity.

Finally, the last two panels (area_mn, ed) show landscape metrics. Both are heavily correlated. Patch area is smallest and edge density highest, when we have a mixture of both crops. Patch area is increasing and edge density is decreasing for landscapes which are dominated by one crop.

Of course, we are again intrested at trade-offs between consumption, carbon and biodiversity. Here, it might be interesting to see if we find overlapping areas of maximum benefit. Or in other words: do we find areas in these tile plots, where all three metrics are in the highest class? In order to calculate these trade-offs, again I classified these three outputs. This time I used 4 classes (representing quartiles) to keep the score calculation more simple. I then calculated the mean class-value for each cell of our full-factorial design. Meaning, if a cell has the value 4, it was found in the maximum class for all considered outputs.

```{r tradeoff, fig.align = 'center', out.width = "100%", fig.cap = "Tradeoffs"}
knitr::include_graphics("../../03_Analyses/05_Refforts_constantPrices/prices_ff_tradeoff_p2.png")
```

And indeed, we find combinations with a value of 4 (Fig. \@ref(fig:tradeoff)), even for all three outputs (right panel). However, we only find this when prices are high for both crops.
What we can also see is that class values are higher when rubber prices are high and the landscape has a relatively higher rubber fraction. In sumamry, landscapes that are oil palm dominated show stronger trade-offs between the economic and ecological sphere than landscapes that are rubber dominated!
REMINDER: Biodiversity values are still based on rough estimates!


## Outlook

The most important thing is to improve the biodiversity model. Julia is working on this!
Besides that some questions need to be discussed:

* What do you think of the experimental design (full-factorial with constant prices)?
    * I find it very interesting and easy to understand - Is this interesting also for publication (I think yes)?
    * Do you have suggestions for improvements? (other/additional metrics)
    * Should we add even more complexity?
* How do we want to treat the abandoned land in the future?
* What is going wrong with the capitalstock?
* Why do we see the highest AND lowest carbon class for low prices?



<!-- The following line inserts a page break  -->
\newpage

# References 
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
